<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="blackbay Manifest Generator - free Lua & SteamTools manifest generator for Steam games. Quickly generate and download AppID files for your Steam library.">
    <meta name="author" content="plxt79">
    <title>blackbay: Manifest Generator</title>
    <link rel="icon" type="image/x-icon" href="/icon.ico">
    <link rel="shortcut icon" href="/icon.png">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        :root {
            --primary-color: #435dd8;
            --bg-color: #000000;
            --sidebar-bg: #121212;
            --content-bg: #20202040;
            --border-color: #404040DD;
            --text-color: #FFFFFF;
            --link-color: #0085C5;
            --hover-color: #435dd8;
            --signup-badge: #ffcc00;
        }

        * {
            font-family: "Poppins", sans-serif;
            color: #FFFFFF;
            transition: all 0.3s ease;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            --color: rgba(114, 114, 114, 0.3);
            background-image: linear-gradient(0deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%, transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, var(--color) 25%, var(--color) 26%, transparent 27%, transparent 74%, var(--color) 75%, var(--color) 76%, transparent 77%, transparent);
            background-size: 55px 55px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--border-color);
        }

        .logo {
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--primary-color);
            text-decoration: none;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        button {
            background-color: rgba(67, 93, 216, 0.2);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        button:hover {
            background-color: rgba(67, 93, 216, 0.3);
        }

        button:hover:not(#genAppID):not(#closePolicy) {
            transform: translateY(-2px);
        }

        .generator-container {
            background-color: var(--content-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .terminal-header {
            background-color: var(--sidebar-bg);
            padding: 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .terminal-buttons {
            display: flex;
            gap: 8px;
        }

        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .terminal-button.red {
            background-color: #ff605c;
        }

        .terminal-button.yellow {
            background-color: #ffbd44;
        }

        .terminal-button.green {
            background-color: #00ca4e;
        }

        .terminal-title {
            margin-left: 15px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .terminal-body {
            padding: 30px;
        }

        .input-group {
            display: flex;
            margin-bottom: 20px;
        }

        input {
            flex: 1;
            background-color: rgba(64, 64, 64, 0.4);
            border: 1px solid var(--border-color);
            border-radius: 5px 0 0 5px;
            padding: 12px 15px;
            color: white;
            outline: none;
            border-right: none;
        }

        input:focus {
            border-color: var(--primary-color);
        }

        .submit-btn {
            border-radius: 0 5px 5px 0;

        }

        .info-text {
            text-align: center;
            color: #aaa;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .note-box {
            background-color: rgba(255, 204, 0, 0.1);
            border: 1px solid var(--signup-badge);
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            position: relative;
        }

        .file-count {
            text-align: center;
            margin: 15px 0;
            color: var(--primary-color);
            font-weight: 500;
        }

        .policy-links {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .policy-links a {
            color: var(--primary-color);
        }

        #policyModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        #policyModal.active {
            opacity: 1;
        }

        #policyModal>div {
            background: var(--content-bg);
            color: var(--text-color);
            max-width: 800px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
            border-radius: 10px;
            padding: 25px;
            position: relative;
            transform: translateY(-50px);
            transition: transform 0.4s ease;
            border: 1px solid var(--border-color);
        }

        #policyModal.active>div {
            transform: translateY(0);
        }

        #policyModal button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.2rem;
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
        }

        #policyContent {
            font-size: 0.9rem;
            line-height: 1.6;
            padding: 25px;
            color: var(--text-color);
        }

        #policyContent h2,
        #policyContent strong {
            color: var(--primary-color);
        }

        #policyContent p {
            color: var(--text-color);
            margin-bottom: 12px;
        }

        #policyContent ul {
            margin: 12px 0;
            padding-left: 20px;
        }

        #policyContent li {
            margin-bottom: 8px;
            color: var(--muted-color, #aaa);
        }

        #policyContent li strong {
            color: var(--primary-color);
        }

        #policyContent p:first-of-type {
            margin-bottom: 15px;
        }

        #toast {
            position: fixed;
            top: 25%;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: #333;
            color: #000000;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px #0005;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s ease;
            z-index: 9999;
            text-align: center;
            font-size: 0.9rem;
            max-width: 80%;
            word-wrap: break-word;
        }

        #toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .tooltip {
            display: inline-block;
            position: relative;
            cursor: pointer;
            background: rgba(67, 93, 216, 0.2);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            font-size: 0.85rem;
            margin-left: 5px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .tooltip:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        .tooltip-text {
            visibility: hidden;
            width: 360px;
            max-width: 90vw;
            background-color: var(--sidebar-bg);
            color: var(--text-color);
            text-align: left;
            border-radius: 8px;
            padding: 15px;
            position: absolute;
            z-index: 1000;
            top: 60%;
            left: 110%;
            transform: translateY(-60%);
            opacity: 0;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            font-weight: normal;
            font-size: 0.9rem;
            line-height: 1.5;
            word-wrap: break-word;
            white-space: normal;
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 60%;
            left: 0;
            transform: translateY(-60%);
            border-width: 8px;
            border-style: solid;
            border-color: transparent var(--sidebar-bg) transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
            transform: translateY(-60%);
        }

        .mobile-block {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }

        @media (max-width: 768px) {
            .mobile-block {
                display: flex;
                color: #fff;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }

            body>*:not(.mobile-block) {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div id="toast">toast message</div>

    <div class="mobile-block">
        <h2>⚠️ Access Denied</h2>
        <p>This page is only available on desktop.</p>
        <button onclick="home()">Home</button>
    </div>

    <div class="container">
        <header>
            <a href="/" class="logo">blackbay</a>
            <div class="nav-buttons">
                <button onclick="home()">Home</button>
                <button onclick="requestpage()">Request Games</button>
                <button class="discord-btn" onclick="window.open('https://discord.gg/UepE6DMju3', '_blank')">
                    <img src="/discord-logo.png" alt="Discord"
                        style="width:16px; height:16px; margin-right:6px; vertical-align:middle;">
                    Support
                </button>
            </div>
        </header>

        <div class="generator-container">
            <div class="terminal-header">
                <div class="terminal-buttons">
                    <div class="terminal-button red"></div>
                    <div class="terminal-button yellow"></div>
                    <div class="terminal-button green"></div>
                </div>
                <div class="terminal-title">Manifest Generator</div>
            </div>

            <div class="terminal-body">
                <div class="input-group">
                    <input id="AppIDInput" placeholder="AppID / Steam URL" autocomplete="off">
                    <button class="submit-btn" id="genAppID" onclick="generate()">Submit</button>
                </div>

                <div class="file-count">Total Files: <span id="file-count">Loading...</span></div>

                <div class="note-box">
                    <strong>Note:</strong> You need the latest version of <a href="https://steamtools.net/download.html">SteamTools</a> for these files to work.
                    <span class="tooltip">?
                        <span class="tooltip-text">
                            The latest version of SteamTools only requires Lua files to unlock games. Manifest files are no longer provided by blackbay as they're no longer needed with current SteamTools versions. Games will be automatically updated so you don't need to request updates now. Simply drag the Lua file to your SteamTools icon to unlock the game.
                        </span>
                    </span>
                </div>

                <p class="info-text">Not affiliated with Valve or Steam</p>
            </div>
        </div>
    </div>

    <div id="user-ip" style="position: fixed; bottom: 10px; left: 10px; font-size: 0.8rem; color: #aaa;">Your IP:
        Unknown</div>

    <div class="policy-links">
        <a href="javascript:void(0)" onclick="openPolicy('privacy')">Privacy Policy</a>
        <a href="javascript:void(0)" onclick="openPolicy('terms')">Terms of Service</a>
    </div>

    <div id="policyModal">
        <div>
            <button onclick="closePolicy()" id="closePolicy">✖</button>
            <div id="policyContent"></div>
        </div>
    </div>

    <script>
        const privacyText = `
            <h2>Privacy Policy</h2>
            <p>Last Updated: 2025-09-03</p>
            <p>blackbay ("we," "our," "us") respects your privacy. This Privacy Policy explains what data we collect, how we use it, and your rights when using our services.</p>
            <ul>
                <li><strong>Data We Collect:</strong> AppID submissions, IP addresses for Discord notifications.</li>
                <li><strong>Usage:</strong> Requests prioritization, file existence checks, error logging.</li>
                <li><strong>Data Retention:</strong> Temporary storage in Discord notifications only.</li>
                <li><strong>Your Rights:</strong> Stop using services anytime, request removal from Discord logs.</li>
            </ul>
        `;

        const termsText = `
            <h2>Terms of Service</h2>
            <p>Last Updated: 2025-09-03</p>
            <ul>
                <li>blackbay provides free access to its Manifest & Lua generator.</li>
                <li>Do not abuse or redistribute our files without permission.</li>
                <li>Files are provided "as-is." We are not responsible for damages or misuse.</li>
                <li>Use is limited to personal, non-commercial purposes unless otherwise authorized.</li>
                <li>We may update these terms at any time. Continued use constitutes acceptance.</li>
            </ul>
        `;

        function openPolicy(type) {
            const modal = document.getElementById('policyModal');
            const content = document.getElementById('policyContent');

            content.innerHTML = type === 'privacy' ? privacyText : termsText;

            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('active');
            }, 10);
        }

        function closePolicy() {
            const modal = document.getElementById('policyModal');

            modal.classList.remove('active');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 400);
        }

        document.getElementById('policyModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closePolicy();
            }
        });

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closePolicy();
            }
        });
    </script>

    <script>
        let userIP = "Unknown";

        async function fetchIP() {
            try {
                const res = await fetch("https://api.ipify.org?format=json");
                const data = await res.json();
                userIP = data.ip;
                document.getElementById("user-ip").textContent = `Your IP: ${userIP}`;
            } catch {
                document.getElementById("user-ip").textContent = `Your IP: Unknown`;
            }
        }
        fetchIP();
    </script>

    <script>
        function showToast(message, backgroundColor = "#333", duration = 1500, textColor = "#000") {
            const toast = document.getElementById("toast");
            toast.textContent = message;
            toast.style.backgroundColor = backgroundColor;
            toast.style.color = textColor;

            toast.classList.add("show");

            setTimeout(() => toast.classList.remove("show"), duration);
        }

        async function generate() {
            const inputEl = document.getElementById("AppIDInput");
            const input = inputEl.value.trim();

            const urlMatch = input.match(/^https?:\/\/store\.steampowered\.com\/app\/(\d+)/);
            const isNumeric = /^\d+$/.test(input);
            const AppID = urlMatch ? urlMatch[1] : (isNumeric ? input : null);

            if (!AppID) {
                showToast("Please enter a valid AppID or Steam URL.", "#FF0000", 1500, "#fff");
                inputEl.style.borderColor = "#FF0000";
                setTimeout(() => { inputEl.style.borderColor = ""; }, 1500);
                return;
            }

            const btn = document.getElementById('genAppID');
            btn.disabled = true;
            btn.textContent = "Generating...";

            try {
                const apiRes = await fetch(`/api/getSignedUrl?appid=${encodeURIComponent(AppID)}`);
                const data = await apiRes.json();
                if (!data.url) throw new Error("Failed to get signed URL");

                const response = await fetch(data.url);
                if (!response.ok) {
                    if (response.status === 404) return showToast("AppID unavailable", "#FF0000", 1500, "#fff");
                    if (response.status === 403) return showToast("Download link expired or invalid", "#FF0000", 1500, "#fff");
                    throw new Error(`HTTP error ${response.status}`);
                }

                const contentType = response.headers.get('Content-Type');
                if (!contentType || !contentType.includes('zip')) {
                    return showToast("AppID unavailable", "#FF0000", 1500, "#fff");
                }

                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = blobUrl;
                link.download = `${AppID}.zip`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(blobUrl);

                showToast(`Generated App: ${AppID}`, "#00ca4e");

                try {
                    await fetch("/api/logDownload", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ appid: AppID, ip: userIP })
                    });
                } catch (e) {

                }

            } catch (err) {
                showToast(err.message, "#FF0000", 1500, "#fff");
            } finally {
                btn.disabled = false;
                btn.textContent = "Submit";
            }
        }

        function home() { window.location.href = "/"; }
        function requestpage() { window.location.href = "/manifest/request"; }

        async function getFileCount() {
            try {
                const res = await fetch('/api/filecount?json=1');
                const data = await res.json();
                document.getElementById("file-count").textContent = data.count;
            } catch {
                document.getElementById("file-count").textContent = "Error";
            }
        }
        getFileCount();
        setInterval(getFileCount, 5000);

        document.getElementById("AppIDInput").addEventListener("keypress", function (event) {
            if (event.key === "Enter" && !document.getElementById('genAppID').disabled) {
                generate();
            }
        });

        document.addEventListener('keydown', e => {
            const key = e.key.toUpperCase();
            if (key === 'F12' || (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(key))) {
                e.preventDefault();
                showToast("Action blocked", "#FF0000", 1500, "#fff");
            }
        });

        document.addEventListener('contextmenu', e => {
            e.preventDefault();
            showToast("Right-click disabled", "#FF0000", 1500, "#fff");
        });

        if ((/android|iphone|ipad|iPod|blackberry|iemobile|opera mini/i.test(navigator.userAgent)) ||
            (navigator.maxTouchPoints > 1 || Math.max(window.innerWidth, window.innerHeight) <= 800)) {
            document.querySelector('.mobile-block').style.display = 'flex';
        }
    </script>
</body>

</html>